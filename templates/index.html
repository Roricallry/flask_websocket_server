<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å®¢æˆ·ç«¯ç½‘ç«™ï¼ˆ5001ï¼‰</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
</head>
<body class="bg-light">

<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
  <div class="container">
    <a class="navbar-brand" href="#">å®¢æˆ·ç«¯ç½‘ç«™</a>
    <div class="ms-auto">
      <a href="/logout" class="btn btn-outline-danger">æ³¨é”€</a>
    </div>
  </div>
</nav>

<div class="container py-4">
  <h1 class="mb-4 text-center">å®¢æˆ·ç«¯ç½‘ç«™ (https://localhost:5001)</h1>
  <div id="messages" class="mb-3"></div>
  <div id="form_area" class="card p-3 shadow"></div>
</div>

<script>
  let socketId = null;

  const socket = io('https://localhost:5000', {
    transports: ['websocket'],
    secure: true,
    rejectUnauthorized: false
  });

  socket.on('connect', () => {
    socketId = socket.id;
    const msg = `âœ… å·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼ˆ5000ï¼‰ï¼ŒSocket ID: ${socketId}`;
    document.getElementById('messages').innerHTML += `<div class="alert alert-success">${msg}</div>`;
    socket.emit('client_connected', { socket_id: socketId });
  });

  socket.on('server_message', (data) => {
    console.log('æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯:', data.data);
    document.getElementById('messages').innerHTML += `<div class="alert alert-info">${data.data}</div>`;
  });

  socket.on('form_request', () => {
    const formHtml = `
      <h2>ğŸ“ å¡«å†™ç»Ÿè®¡è¡¨å•</h2>
      <form id="statsForm" class="mb-3">
        <div class="mb-3">
          <label>å§“å</label>
          <input type="text" name="name" class="form-control" required>
        </div>
        <div class="mb-3">
          <label>å¹´é¾„</label>
          <input type="number" name="age" class="form-control" required>
        </div>
        <div class="mb-3">
          <label>æ„è§</label>
          <input type="text" name="feedback" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">æäº¤</button>
      </form>
    `;
    document.getElementById('form_area').innerHTML = formHtml;

    document.getElementById('statsForm').onsubmit = (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      data.socket_id = socketId;
      socket.emit('form_response', data);
      document.getElementById('form_area').innerHTML = `<div class="alert alert-success">âœ… è¡¨å•å·²æäº¤</div>`;
    };
  });

  socket.on('disconnect', () => {
    console.log('âŒ å·²æ–­å¼€è¿æ¥');
    document.getElementById('messages').innerHTML += `<div class="alert alert-danger">âŒ å·²æ–­å¼€è¿æ¥</div>`;
  });
</script>

</body>
</html>
