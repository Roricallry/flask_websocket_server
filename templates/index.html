<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>客户端网站（5001）</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
</head>
<body class="bg-light">

<!-- 顶部导航栏 -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
  <div class="container">
    <a class="navbar-brand" href="#">客户端网站</a>
    <div class="ms-auto">
      <a href="/logout" class="btn btn-outline-danger">注销</a>
    </div>
  </div>
</nav>

<div class="container py-4">
  <h1 class="mb-4 text-center">客户端网站 (https://localhost:5001)</h1>
  <div id="messages" class="mb-3"></div>
  <div id="form_area" class="card p-3 shadow"></div>
</div>

<script>
  let socketId = null;

  const socket = io('https://localhost:5000', {
    transports: ['websocket'],
    secure: true,
    rejectUnauthorized: false
  });

  socket.on('connect', () => {
    socketId = socket.id;
    const msg = `✅ 已连接到服务器（5000），Socket ID: ${socketId}`;
    document.getElementById('messages').innerHTML += `<div class="alert alert-success">${msg}</div>`;
    socket.emit('client_connected', { socket_id: socketId });
  });

  socket.on('server_message', (data) => {
    console.log('收到服务器消息:', data.data);
    document.getElementById('messages').innerHTML += `<div class="alert alert-info">${data.data}</div>`;
  });

  socket.on('form_request', () => {
    const formHtml = `
      <h2>📝 填写统计表单</h2>
      <form id="statsForm" class="mb-3">
        <div class="mb-3">
          <label>姓名</label>
          <input type="text" name="name" class="form-control" required>
        </div>
        <div class="mb-3">
          <label>年龄</label>
          <input type="number" name="age" class="form-control" required>
        </div>
        <div class="mb-3">
          <label>意见</label>
          <input type="text" name="feedback" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">提交</button>
      </form>
    `;
    document.getElementById('form_area').innerHTML = formHtml;

    document.getElementById('statsForm').onsubmit = (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      data.socket_id = socketId;
      socket.emit('form_response', data);
      document.getElementById('form_area').innerHTML = `<div class="alert alert-success">✅ 表单已提交</div>`;
    };
  });

  socket.on('disconnect', () => {
    console.log('❌ 已断开连接');
    document.getElementById('messages').innerHTML += `<div class="alert alert-danger">❌ 已断开连接</div>`;
  });
</script>

</body>
</html>
